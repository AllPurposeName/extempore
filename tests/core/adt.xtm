;;; tests/adt.xtm -- unit tests for libs/core/adt.xtm

;; Author: Ben Swift
;; Keywords: extempore
;; Required dylibs:

;;; Commentary:

;;

;;; Code:

(sys:load "tests/test.xtm")
(sys:load "libs/core/adt.xtm")

(bind-func test_point_1
  (lambda ()
    (let ((pt (Point 9 4)))
      (+ (first pt)
         (second pt)))))

(test-xtfunc (test_point_1) 13)

(bind-func test_point_2
  (lambda ()
    (let ((pt1 (Point 9 4))
          (pt2 (Point .3 .6)))
      (+ (convert (+ (first pt1)
                     (second pt1)))
         (+ (first pt2)
            (second pt2))))))

(test-xtfunc (test_point_2) 13.9)

(print-test-results)

(bind-func test_list_ptr
  (lambda ()
    (let ((lst_ptr:List** (alloc 2)))
      (pset! lst_ptr 0 (list 1 2 3))
      (pset! lst_ptr 1 (list 4 5 6))
      (nth (pref lst_ptr 1) 1))))

(test-xtfunc (test_list_ptr) 5)

(bind-func test_copy_list
  (lambda ()
    (letz ((l1 (list 1 2 3))
           (l2 (copy l1)))
      (and (equal l1 l2)
           (not (= l1 l2))))))

(test-xtfunc (test_copy_list) 1)

(bind-func test_nth_tail
  (lambda ()
    (let ((lst (list 1 2 3)))
      (nth_tail lst -3)
      (length (nth_tail lst 6)))))

(test-xtfunc (test_nth_tail) 0)

(bind-func test_nth_tailr
  (lambda ()
    (let ((lst (list 1 2 3)))
      (nth_tailr lst -3)
      (length (nth_tailr lst 6)))))

(test-xtfunc (test_nth_tailr) 0)

(bind-func test_nth_tail_both
  (lambda ()
    (let ((lst (list 1 2 3)))
      (equal (nth_tail lst 1)
             (nth_tailr lst 1)))))

(test-xtfunc (test_nth_tail_both) 1)
