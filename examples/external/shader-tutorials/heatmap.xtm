(sys:load "examples/external/shader-tutorials/shader-setup.xtm")

(bind-func gl_set_depth_test
  (lambda ()
    (glEnable GL_DEPTH_TEST)
    (glDepthFunc 257))) ;; GL_LESS

(gl_set_depth_test)

(bind-val fullscreen_quad_vert_data float* 8)

(bind-val vbo VBO*)
(bind-val vao VAO*)

;; init
(call-as-xtlang
 (pfill! fullscreen_quad_vert_data
         ;; pos (2D)
         -1.0  1.0
          1.0  1.0
         -1.0 -1.0
          1.0 -1.0)
 (set! vbo (create_vbo fullscreen_quad_vert_data 16))
 (bind_vbo vbo)
 (set! vao (create_vao))
 (bind_attribute vao vbo 0 2 8 0)
 void)

(define *heatmap-shader*
  (create_shader (file->string "examples/external/shader-tutorials/heatmap.vert")
                 (file->string "examples/external/shader-tutorials/heatmap.frag")))

(bind-func gl_draw
  (lambda (program)
    (glClear (+ GL_COLOR_BUFFER_BIT GL_DEPTH_BUFFER_BIT))
    (glUseProgram program)
    (draw_vertex_array vao GL_TRIANGLE_STRIP 0 4)
    void))

;; draw the map
(begin
  (gl_draw *heatmap-shader*)
  (gl:swap-buffers *gl-window*))
