(sys:load "libs/external/glfw3.xtm")

(bind-val window GLFWwindow*)

(call-as-xtlang
 (set! window (glfw_init_and_create_fullscreen_window)))

(bind-val fullscreen_quad_vert_data float* 8)

(bind-val vbo VBO*)
(bind-val vao VAO*)
(bind-val sp ShaderProgram)

;; init
(call-as-xtlang
 (pfill! fullscreen_quad_vert_data
         ;; pos (2D)
         -1.0  1.0
          1.0  1.0
         -1.0 -1.0
          1.0 -1.0)
 (set! vbo (VBO_create fullscreen_quad_vert_data 16))
 (set! vao (VAO_create))
 (bind_attribute vao vbo 0 2 2 0)
 void)

(bind-func gl_draw
  (lambda ()
    (glClear GL_COLOR_BUFFER_BIT)
    (glUseProgram sp)
    (draw_vertex_array vao GL_TRIANGLE_STRIP 0 4)
    (glfwSwapBuffers window)
    void))

(bind-func create_heatmap_shader
  (lambda (vsource:i8* fsource:i8*)
    (set! sp (ShaderProgram_create vsource fsource))))

(create_heatmap_shader (file->string "examples/external/shader-tutorials/heatmap.vert")
                       (file->string "examples/external/shader-tutorials/heatmap.frag"))

;; draw the map
(gl_draw)
